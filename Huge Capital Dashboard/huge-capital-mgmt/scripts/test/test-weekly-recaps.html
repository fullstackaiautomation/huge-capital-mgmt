<!DOCTYPE html>
<html>
<head>
    <title>Create Weekly Recaps Table</title>
</head>
<body>
    <h1>Setup Weekly Recaps Table</h1>
    <button onclick="createTable()">Click to Create Table in Supabase</button>
    <div id="result"></div>

    <script>
        async function createTable() {
            const result = document.getElementById('result');
            result.innerHTML = '<p>Checking table status...</p>';

            // These are from your .env file
            const supabaseUrl = 'https://oymwsfyspdvbazklqkpm.supabase.co';
            const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYnNlIiwicmVmIjoib3ltd3NmeXNwZHZiYXprbHFrcG0iLCJyb2xlIjoiYW5vbiIsImlhdCI6MTc1OTMwMjIzNSwiZXhwIjoyMDc0ODc4MjM1fQ.EZUSSmzDwZkqhOvdjcDp6KoZd_Au3i5xRm5t7QlosmU';

            try {
                // Test if table exists
                const response = await fetch(`${supabaseUrl}/rest/v1/weekly_recaps?select=*&limit=1`, {
                    headers: {
                        'apikey': supabaseKey,
                        'Authorization': `Bearer ${supabaseKey}`,
                    }
                });

                if (response.ok) {
                    result.innerHTML = '<p style="color: green;">✅ Table already exists! You can use the Weekly Recap feature.</p>';
                } else {
                    result.innerHTML = `
                        <p style="color: orange;">⚠️ Table doesn't exist yet. Please create it:</p>
                        <ol>
                            <li><a href="https://app.supabase.com/project/oymwsfyspdvbazklqkpm/sql/new" target="_blank">Click here to open Supabase SQL Editor</a></li>
                            <li>Copy the SQL below and paste it there</li>
                            <li>Click "Run"</li>
                        </ol>
                        <textarea style="width: 100%; height: 400px; font-family: monospace; font-size: 12px;">
-- Create weekly_recaps table
CREATE TABLE IF NOT EXISTS weekly_recaps (
  id UUID DEFAULT gen_random_uuid() PRIMARY KEY,
  week_number INTEGER NOT NULL,
  week_start DATE NOT NULL,
  week_end DATE NOT NULL,
  category VARCHAR(100) NOT NULL,
  what_was_done TEXT,
  quantity TEXT,
  wins_highlights TEXT,
  issues_notes TEXT,
  created_at TIMESTAMP WITH TIME ZONE DEFAULT timezone('utc', now()),
  updated_at TIMESTAMP WITH TIME ZONE DEFAULT timezone('utc', now()),
  user_id VARCHAR(100) DEFAULT 'dillon'
);

-- Create indexes for better query performance
CREATE INDEX IF NOT EXISTS idx_weekly_recaps_week ON weekly_recaps(week_number, week_start);
CREATE INDEX IF NOT EXISTS idx_weekly_recaps_category ON weekly_recaps(category);
CREATE INDEX IF NOT EXISTS idx_weekly_recaps_user ON weekly_recaps(user_id);

-- Enable RLS (Row Level Security)
ALTER TABLE weekly_recaps ENABLE ROW LEVEL SECURITY;

-- Create policy to allow all operations
CREATE POLICY "Allow all operations on weekly_recaps" ON weekly_recaps
  FOR ALL
  TO public
  USING (true)
  WITH CHECK (true);
                        </textarea>
                    `;
                }
            } catch (error) {
                result.innerHTML = `<p style="color: red;">Error: ${error.message}</p>`;
            }
        }

        // Auto-run on page load
        window.onload = createTable;
    </script>
</body>
</html>